import React, { useState, useEffect } from 'react';
import { Plus, Minus } from 'lucide-react';

export default function RekuperaceCalculator() {
  const [pocetKusu, setPocetKusu] = useState(1);
  const [marze, setMarze] = useState(0);

  const NAKLADY_KUS = 10000; // 8000 technologie + 2000 práce
  const FEE = 8000;
  const DPH = 0.12;
  const PROVIZE_OZ_PROCENT = 0.10;
  const MIN_CENA_S_DPH = 90000;

  // Výpočty
  const nakladyCelkem = pocetKusu * NAKLADY_KUS + FEE;
  const zakladProVypocet = nakladyCelkem + marze;
  
  // Cena bez DPH musí zahrnovat provizi OZ (která je 10% z celkové ceny bez DPH)
  // Tedy: cenaBezDPH = zakladProVypocet / 0.9
  let cenaBezDPH = zakladProVypocet / (1 - PROVIZE_OZ_PROCENT);
  let cenaSDPH = cenaBezDPH * (1 + DPH);
  let skutecnaMarze = marze;

  // Pokud je cena s DPH menší než minimum, přepočítáme
  if (cenaSDPH < MIN_CENA_S_DPH) {
    cenaSDPH = MIN_CENA_S_DPH;
    cenaBezDPH = cenaSDPH / (1 + DPH);
    const zakladZCeny = cenaBezDPH * (1 - PROVIZE_OZ_PROCENT);
    skutecnaMarze = zakladZCeny - nakladyCelkem;
  }

  const provizeOZ = cenaBezDPH * PROVIZE_OZ_PROCENT;
  const zisk = cenaBezDPH - nakladyCelkem - provizeOZ;

  const formatCena = (cislo) => {
    return new Intl.NumberFormat('cs-CZ', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    }).format(cislo) + ' Kč';
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
      <div className="max-w-4xl mx-auto">
        <div className="bg-white rounded-2xl shadow-xl p-8">
          <h1 className="text-3xl font-bold text-gray-800 mb-8 text-center">
            Kalkulátor ceny rekuperace
          </h1>

          {/* Počet kusů */}
          <div className="mb-8 p-6 bg-gray-50 rounded-xl">
            <label className="block text-lg font-semibold text-gray-700 mb-4">
              Počet kusů rekuperací
            </label>
            <div className="flex items-center gap-4">
              <button
                onClick={() => setPocetKusu(Math.max(1, pocetKusu - 1))}
                className="bg-red-500 hover:bg-red-600 text-white p-3 rounded-lg transition-colors"
              >
                <Minus size={20} />
              </button>
              <div className="flex-1 text-center">
                <input
                  type="number"
                  value={pocetKusu}
                  onChange={(e) => setPocetKusu(Math.max(1, parseInt(e.target.value) || 1))}
                  className="w-32 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg p-2"
                  min="1"
                />
                <span className="text-gray-600 ml-2">ks</span>
              </div>
              <button
                onClick={() => setPocetKusu(pocetKusu + 1)}
                className="bg-green-500 hover:bg-green-600 text-white p-3 rounded-lg transition-colors"
              >
                <Plus size={20} />
              </button>
            </div>
          </div>

          {/* Marže */}
          <div className="mb-8 p-6 bg-gray-50 rounded-xl">
            <label className="block text-lg font-semibold text-gray-700 mb-4">
              Marže (bez DPH)
            </label>
            <input
              type="number"
              value={marze}
              onChange={(e) => setMarze(parseFloat(e.target.value) || 0)}
              className="w-full text-xl border-2 border-gray-300 rounded-lg p-3"
              placeholder="0"
              step="100"
            />
          </div>

          {/* Náklady */}
          <div className="mb-8 p-6 bg-blue-50 rounded-xl border-2 border-blue-200">
            <h2 className="text-xl font-bold text-gray-800 mb-4">Náklady</h2>
            <div className="space-y-2">
              <div className="flex justify-between">
                <span className="text-gray-600">Kusů × 10 000 Kč:</span>
                <span className="font-semibold">{formatCena(pocetKusu * NAKLADY_KUS)}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-gray-600">FEE (doprava + test):</span>
                <span className="font-semibold">{formatCena(FEE)}</span>
              </div>
              <div className="border-t-2 border-blue-300 pt-2 flex justify-between">
                <span className="text-gray-800 font-bold">Náklady celkem:</span>
                <span className="font-bold text-lg">{formatCena(nakladyCelkem)}</span>
              </div>
            </div>
          </div>

          {/* Ceny */}
          <div className="mb-8 p-6 bg-green-50 rounded-xl border-2 border-green-200">
            <h2 className="text-xl font-bold text-gray-800 mb-4">Prodejní cena</h2>
            <div className="space-y-2">
              <div className="flex justify-between">
                <span className="text-gray-600">Cena bez DPH:</span>
                <span className="font-semibold">{formatCena(cenaBezDPH)}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-gray-600">Provize OZ (10%):</span>
                <span className="font-semibold text-orange-600">{formatCena(provizeOZ)}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-gray-600">DPH (12%):</span>
                <span className="font-semibold">{formatCena(cenaSDPH - cenaBezDPH)}</span>
              </div>
              <div className="border-t-2 border-green-300 pt-2 flex justify-between">
                <span className="text-gray-800 font-bold">Cena s DPH:</span>
                <span className="font-bold text-2xl text-green-700">{formatCena(cenaSDPH)}</span>
              </div>
              {cenaSDPH === MIN_CENA_S_DPH && (
                <div className="mt-2 text-sm text-orange-600 font-medium">
                  ⚠ Minimální cena 90 000 Kč s DPH
                </div>
              )}
            </div>
          </div>

          {/* Zisk */}
          <div className="p-6 bg-purple-50 rounded-xl border-2 border-purple-200">
            <h2 className="text-xl font-bold text-gray-800 mb-4">Výsledek</h2>
            <div className="space-y-2">
              {skutecnaMarze !== marze && (
                <div className="flex justify-between">
                  <span className="text-gray-600">Skutečná marže (kvůli minimu):</span>
                  <span className="font-semibold text-orange-600">{formatCena(skutecnaMarze)}</span>
                </div>
              )}
              <div className="flex justify-between items-center">
                <span className="text-gray-800 font-bold text-lg">Zisk:</span>
                <span className={`font-bold text-2xl ${zisk >= 0 ? 'text-green-700' : 'text-red-700'}`}>
                  {formatCena(zisk)}
                </span>
              </div>
            </div>
          </div>

          {/* Info */}
          <div className="mt-6 p-4 bg-gray-100 rounded-lg text-sm text-gray-600">
            <p className="font-semibold mb-1">Poznámka:</p>
            <p>Zisk = Cena bez DPH - Náklady celkem - Provize OZ</p>
          </div>
        </div>
      </div>
    </div>
  );
}
