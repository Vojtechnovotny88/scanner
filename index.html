<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulátor ceny rekuperace</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom right, #e0f2fe, #c7d2fe);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #1f2937;
            margin-bottom: 30px;
        }

        .box {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 8px;
        }

        .box-gray {
            background: #f9fafb;
        }

        .box-blue {
            background: #eff6ff;
            border: 2px solid #bfdbfe;
        }

        .box-green {
            background: #f0fdf4;
            border: 2px solid #bbf7d0;
        }

        .box-purple {
            background: #faf5ff;
            border: 2px solid #e9d5ff;
        }

        .box-title {
            font-size: 20px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-size: 18px;
            font-weight: bold;
            color: #374151;
            margin-bottom: 15px;
        }

        .counter {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }

        .btn-minus {
            background: #ef4444;
            color: white;
        }

        .btn-minus:hover {
            background: #dc2626;
        }

        .btn-plus {
            background: #22c55e;
            color: white;
        }

        .btn-plus:hover {
            background: #16a34a;
        }

        .counter-middle {
            flex: 1;
            text-align: center;
        }

        input[type="number"] {
            border: 2px solid #d1d5db;
            border-radius: 6px;
            padding: 8px;
            font-size: 16px;
        }

        .input-kusy {
            width: 100px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }

        .input-marze {
            width: 100%;
            font-size: 18px;
            padding: 10px;
        }

        .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .row-total {
            border-top: 2px solid #d1d5db;
            padding-top: 8px;
            margin-top: 8px;
        }

        .label-text {
            color: #6b7280;
        }

        .label-bold {
            color: #1f2937;
            font-weight: bold;
        }

        .value {
            font-weight: bold;
        }

        .value-large {
            font-size: 24px;
        }

        .value-xlarge {
            font-size: 28px;
        }

        .green {
            color: #15803d;
        }

        .red {
            color: #dc2626;
        }

        .orange {
            color: #ea580c;
        }

        .warning {
            margin-top: 10px;
            font-size: 14px;
            color: #ea580c;
            font-weight: bold;
        }

        .info {
            margin-top: 20px;
            padding: 15px;
            background: #f3f4f6;
            border-radius: 6px;
            font-size: 14px;
            color: #6b7280;
        }

        .info p:first-child {
            font-weight: bold;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Kalkulátor ceny rekuperace</h1>

        <div class="box box-gray">
            <label>Počet kusů rekuperací</label>
            <div class="counter">
                <button class="btn btn-minus" onclick="zmenaKusu(-1)">−</button>
                <div class="counter-middle">
                    <input type="number" id="pocetKusu" class="input-kusy" value="1" min="1" oninput="prepocitat()">
                    <span> ks</span>
                </div>
                <button class="btn btn-plus" onclick="zmenaKusu(1)">+</button>
            </div>
        </div>

        <div class="box box-gray">
            <label>Marže (bez DPH)</label>
            <input type="number" id="marze" class="input-marze" value="0" step="100" placeholder="0" oninput="prepocitat()">
        </div>

        <div class="box box-blue">
            <div class="box-title">Náklady</div>
            <div class="row">
                <span class="label-text">Kusů × 10 000 Kč:</span>
                <span class="value" id="nakladyKusu">0,00 Kč</span>
            </div>
            <div class="row">
                <span class="label-text">FEE (doprava + test):</span>
                <span class="value">8 000,00 Kč</span>
            </div>
            <div class="row row-total">
                <span class="label-bold">Náklady celkem:</span>
                <span class="value value-large" id="nakladyCelkem">0,00 Kč</span>
            </div>
            <div class="row">
                <span class="label-text">Požadovaná marže:</span>
                <span class="value green" id="pozadovanaMarze">0,00 Kč</span>
            </div>
            <div class="row">
                <span class="label-bold">Náklady + marže (90%):</span>
                <span class="value" id="nakladyMarze">0,00 Kč</span>
            </div>
        </div>

        <div class="box box-green">
            <div class="box-title">Prodejní cena</div>
            <div class="row">
                <span class="label-text">Cena bez DPH:</span>
                <span class="value" id="cenaBezDPH">0,00 Kč</span>
            </div>
            <div class="row">
                <span class="label-text">Provize OZ (10%):</span>
                <span class="value orange" id="provizeOZ">0,00 Kč</span>
            </div>
            <div class="row">
                <span class="label-text">DPH (12%):</span>
                <span class="value" id="dph">0,00 Kč</span>
            </div>
            <div class="row row-total">
                <span class="label-bold">Cena s DPH:</span>
                <span class="value value-xlarge green" id="cenaSDPH">0,00 Kč</span>
            </div>
            <div id="warningMin" class="warning" style="display: none;">
                ⚠ Minimální cena 90 000 Kč s DPH
            </div>
        </div>

        <div class="box box-purple">
            <div class="box-title">Výsledek</div>
            <div id="skutecnaMarzeRow" class="row" style="display: none;">
                <span class="label-text">Skutečná marže (kvůli minimu):</span>
                <span class="value orange" id="skutecnaMarze">0,00 Kč</span>
            </div>
            <div class="row">
                <span class="label-bold" style="font-size: 20px;">Zisk:</span>
                <span class="value value-xlarge" id="zisk">0,00 Kč</span>
            </div>
            <div class="row">
                <span class="label-text">Dotace:</span>
                <span class="value green">90 000,00 Kč</span>
            </div>
            <div class="row row-total">
                <span class="label-bold">Zákazník doplácí:</span>
                <span class="value" id="doplatek">0,00 Kč</span>
            </div>
        </div>

        <div class="info">
            <p>Poznámka:</p>
            <p>Zisk = Cena bez DPH - Náklady celkem - Provize OZ</p>
        </div>
    </div>

    <script>
        const NAKLADY_KUS = 10000; // technologie + práce
        const FEE = 8000;
        const DPH = 0.12;
        const PROVIZE_OZ_PROCENT = 0.10;
        const MIN_CENA_S_DPH = 90000;

        function formatCena(cislo) {
            return cislo.toLocaleString('cs-CZ', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }) + ' Kč';
        }

        function zmenaKusu(zmena) {
            const input = document.getElementById('pocetKusu');
            const nova = Math.max(1, parseInt(input.value) + zmena);
            input.value = nova;
            prepocitat();
        }

        function prepocitat() {
            const pocetKusu = parseInt(document.getElementById('pocetKusu').value) || 1;
            const marze = parseFloat(document.getElementById('marze').value) || 0;

            const nakladyCelkem = (pocetKusu * NAKLADY_KUS) + FEE;

            // ZÁKLADNÍ CENA (bez marže)
            const nakladyBezMarze = nakladyCelkem;
            let cenaZakladBezDPH = nakladyBezMarze / (1 - PROVIZE_OZ_PROCENT);
            let cenaZakladSDPH = cenaZakladBezDPH * (1 + DPH);
            
            // Pokud je základní cena nižší než minimum, použij minimum
            if (cenaZakladSDPH < MIN_CENA_S_DPH) {
                cenaZakladSDPH = MIN_CENA_S_DPH;
                cenaZakladBezDPH = cenaZakladSDPH / (1 + DPH);
            }

            // MARŽE (přičítá se navíc)
            let marzeSDPHaProvizi = 0;
            let marzeBezDPH = 0;
            if (marze > 0) {
                // marže tvoří 90% nějaké částky
                marzeBezDPH = marze / (1 - PROVIZE_OZ_PROCENT);
                marzeSDPHaProvizi = marzeBezDPH * (1 + DPH);
            }

            // CELKOVÁ CENA (základ + marže)
            const cenaProZakaznikaBezDPH = cenaZakladBezDPH + marzeBezDPH;
            const cenaSDPH = cenaZakladSDPH + marzeSDPHaProvizi;
            
            const nakladyAMarze = nakladyCelkem + marze;
            const provizeOZ = cenaProZakaznikaBezDPH * PROVIZE_OZ_PROCENT;
            const dphCastka = cenaProZakaznikaBezDPH * DPH;
            const zisk = (cenaProZakaznikaBezDPH * (1 - PROVIZE_OZ_PROCENT)) - nakladyCelkem;
            const doplatek = cenaSDPH - 90000;

            const jeMin = (cenaZakladSDPH >= MIN_CENA_S_DPH) ? false : true;
            const skutecnaMarze = marze;

            document.getElementById('nakladyKusu').textContent = formatCena(pocetKusu * NAKLADY_KUS);
            document.getElementById('nakladyCelkem').textContent = formatCena(nakladyCelkem);
            document.getElementById('pozadovanaMarze').textContent = formatCena(marze);
            document.getElementById('nakladyMarze').textContent = formatCena(nakladyAMarze);
            document.getElementById('cenaBezDPH').textContent = formatCena(cenaProZakaznikaBezDPH);
            document.getElementById('provizeOZ').textContent = formatCena(provizeOZ);
            document.getElementById('dph').textContent = formatCena(dphCastka);
            document.getElementById('cenaSDPH').textContent = formatCena(cenaSDPH);
            document.getElementById('doplatek').textContent = formatCena(doplatek);

            const ziskEl = document.getElementById('zisk');
            ziskEl.textContent = formatCena(zisk);
            ziskEl.className = 'value value-xlarge ' + (zisk >= 0 ? 'green' : 'red');

            document.getElementById('warningMin').style.display = jeMin ? 'block' : 'none';

            const marzeRow = document.getElementById('skutecnaMarzeRow');
            if (jeMin) {
                marzeRow.style.display = 'flex';
                document.getElementById('skutecnaMarze').textContent = formatCena(skutecnaMarze);
            } else {
                marzeRow.style.display = 'none';
            }
        }

        prepocitat();
    </script>
</body>
</html>
